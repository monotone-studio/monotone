init
set workers to 0
set interval to 10
set serial to false
set uuid to '00000000-0000-0000-0000-000000000000'
open
# test: rebalance (no pipeline set)
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: create storages
create storage hot
create storage cold
# test: alter pipeline set partitions
alter pipeline set hot (partitions 2), cold
show pipeline
hot (partitions 2) ⟶ cold ()
# test: rebalance #1 (empty, <= partitions)
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #2 (< partitions)
insert 0
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 0
  max                 10
  partitions          1
  partitions_cloud    0
  events              1
  events_heap         1
  size                0M
  size_uncompressed   0M
  size_heap           2M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #3 (= partitions)
insert 10
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 0
  max                 20
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #4 (> partitions)
insert 20
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 0
  max                 30
  partitions          3
  partitions_cloud    0
  events              3
  events_heap         3
  size                0M
  size_uncompressed   0M
  size_heap           6M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 10
  max                 30
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 10
  partitions          1
  partitions_cloud    0
  events              1
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #5 (more then one, > partitions)
insert 30
insert 40
insert 500
insert 600
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 10
  max                 610
  partitions          6
  partitions_cloud    0
  events              6
  events_heap         6
  size                0M
  size_uncompressed   0M
  size_heap           12M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 10
  partitions          1
  partitions_cloud    0
  events              1
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 500
  max                 610
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 50
  partitions          5
  partitions_cloud    0
  events              5
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
select
[0]
[10]
[20]
[30]
[40]
[500]
[600]
(eof)
# test: alter pipeline set partitions zero
alter pipeline set hot (partitions 0)
show pipeline
hot (partitions 0)
# test: rebalance (auto drop)
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 500
  max                 610
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 50
  partitions          5
  partitions_cloud    0
  events              5
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 50
  partitions          5
  partitions_cloud    0
  events              5
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: alter pipeline set partitions zero #2 (chain)
alter pipeline set hot (partitions 2), cold (partitions 0)
show pipeline
hot (partitions 2) ⟶ cold (partitions 0)
# test: rebalance #1 (auto drop existing)
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 0
  max                 50
  partitions          5
  partitions_cloud    0
  events              5
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #2 (auto drop)
insert 0
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 0
  max                 10
  partitions          1
  partitions_cloud    0
  events              1
  events_heap         1
  size                0M
  size_uncompressed   0M
  size_heap           2M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
# test: rebalance #3 (auto drop)
insert 10
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 0
  max                 20
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
select
[0]
[10]
(eof)
# test: rebalance #4 (auto drop from cold)
insert 20
rebalance
show storages debug
main
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
hot
  min                 10
  max                 30
  partitions          2
  partitions_cloud    0
  events              2
  events_heap         2
  size                0M
  size_uncompressed   0M
  size_heap           4M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
cold
  min                 18446744073709551615
  max                 0
  partitions          0
  partitions_cloud    0
  events              0
  events_heap         0
  size                0M
  size_uncompressed   0M
  size_heap           0M
  path                ''
  cloud               ''
  sync                true
  crc                 false
  compression         
  refresh_wm          41943040
  region_size         131072
select
[10]
[20]
(eof)
close
